[supervisord]
nodaemon=true
logfile=./logs/supervisord.log
pidfile=./pids/supervisord.pid
childlogdir=./logs

[unix_http_server]
file=./pids/supervisor.sock

[supervisorctl]
serverurl=unix://./pids/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Orchestrator Service (HTTP API)
[program:orchestrator]
command=./cmd/orchestrator/start.sh
directory=%(here)s
autostart=true
autorestart=true
stdout_logfile=./logs/orchestrator.log
stderr_logfile=./logs/orchestrator-error.log
environment=PORT="8081",REDIS_HOST="localhost",REDIS_PORT="6379",DB_HOST="localhost",DB_PORT="5432",DB_NAME="orchestrator",DB_USER="sdutt"

# Workflow Runner (Coordinator + Executor)
[program:workflow-runner]
command=./cmd/workflow-runner/start.sh
directory=%(here)s
autostart=true
autorestart=true
stdout_logfile=./logs/workflow-runner.log
stderr_logfile=./logs/workflow-runner-error.log
environment=REDIS_HOST="localhost",REDIS_PORT="6379",ORCHESTRATOR_URL="http://localhost:8081",DB_USER="sdutt"

# Fanout Service (WebSocket)
[program:fanout]
command=./cmd/fanout/start.sh
directory=%(here)s
autostart=true
autorestart=true
stdout_logfile=./logs/fanout.log
stderr_logfile=./logs/fanout-error.log
environment=PORT="8084",REDIS_HOST="localhost",REDIS_PORT="6379"

# Python Agent Runner
[program:agent-runner-py]
command=python3 main.py
directory=%(here)s/cmd/agent-runner-py
autostart=true
autorestart=true
stdout_logfile=./logs/agent-runner-py.log
stderr_logfile=./logs/agent-runner-py-error.log
environment=REDIS_HOST="localhost",REDIS_PORT="6379"

# Frontend (React)
[program:frontend]
command=npm run dev
directory=%(here)s/frontend/flow-builder
autostart=true
autorestart=true
stdout_logfile=./logs/frontend.log
stderr_logfile=./logs/frontend-error.log
environment=PORT="5173",VITE_API_URL="http://localhost:8081",VITE_FANOUT_WS_URL="ws://localhost:8084"

# Group: All core services
[group:core]
programs=orchestrator,workflow-runner,fanout

# Group: All services
[group:all]
programs=orchestrator,workflow-runner,fanout,agent-runner-py,frontend
